Meteor.publish('transcripts', function() {
  //if (userId == this.userId) {
    return Transcript.documents.find({reviewCompletedOn:undefined});
  //return Transcript.documents.find();
  //} else {
  //  throw new Meteor.Error("not-authorized");
  //}
});

// Before observers are enabled.
// Caution: Generated fields 'observe' changes and hence won't get generated at this phase!!!
Document.prepare(function() {
  console.log("prepare says 'helloooo todd'");
});

// After Meteor startup, including peerdb observers getting enabled.
Document.startup(function() {
  //todo: remove this insert
  SimpleSchema.debug = true;
  var pescXml = "<ns0:CollegeTranscript xmlns:ns0=\"urn:org:pesc:message:CollegeTranscript:v1.3.0\"><TransmissionData><DocumentID>b5740b7d-98ff-4744-9342-17762b2a4f31</DocumentID><CreatedDateTime>2015-07-09T02:49:41.5626857-04:00</CreatedDateTime><DocumentTypeCode>RequestedRecord</DocumentTypeCode><TransmissionType>Original</TransmissionType><Source><Organization><CSIS>353200</CSIS><OrganizationName>Centennial</OrganizationName><Contacts><Address><AddressLine>801-a, promenade de l'Aviation</AddressLine><City>Ottawa</City><StateProvince>ON</StateProvince><PostalCode>K1K 4R3</PostalCode><CountryCode>CA</CountryCode></Address><Phone><PhoneNumber>6137422483</PhoneNumber><PhoneNumberExtension>2879</PhoneNumberExtension></Phone><FaxPhone><PhoneNumber>6137422481</PhoneNumber></FaxPhone><Email><EmailAddress>dewawp8r458@mailinator.com</EmailAddress></Email><URL><URLAddress>www3.lacitec.on.ca</URLAddress></URL><NoteMessage>Denis Gravel</NoteMessage></Contacts></Organization></Source><Destination><Organization><CSIS>353900</CSIS><OrganizationName>Georgian</OrganizationName></Organization></Destination><DocumentProcessCode>TEST</DocumentProcessCode><DocumentOfficialCode>Official</DocumentOfficialCode><DocumentCompleteCode>Complete</DocumentCompleteCode><RequestTrackingID>C20150709002289</RequestTrackingID></TransmissionData><Student><Person><SchoolAssignedPersonID>0</SchoolAssignedPersonID><AgencyAssignedID>140046966</AgencyAssignedID><Birth><Birthday>--07-04</Birthday></Birth><Name><NameCode>Formal</NameCode><NamePrefix>Mrs</NamePrefix><FirstName>Emeryville</FirstName><LastName>Franks</LastName></Name><Gender><GenderCode>Female</GenderCode></Gender></Person><AcademicRecord><AcademicAward><AcademicAwardLevel>4.1</AcademicAwardLevel><AcademicAwardDate>2005-08-31</AcademicAwardDate><AcademicAwardTitle>Ontario College Graduate Cert</AcademicAwardTitle><AcademicHonors><HonorsTitle>Honours</HonorsTitle><HonorsLevel>FirstHighest</HonorsLevel></AcademicHonors><AcademicCompletionIndicator>true</AcademicCompletionIndicator><AcademicAwardProgram><ProgramSecondarySchoolCode>CareerPrep</ProgramSecondarySchoolCode><AcademicProgramType>Major</AcademicProgramType><AcademicProgramName>International Project Manageme</AcademicProgramName></AcademicAwardProgram></AcademicAward><AcademicSummary><AcademicSummaryType>SenderOnly</AcademicSummaryType><AcademicSummaryLevel>Undergraduate</AcademicSummaryLevel><GPA><CreditHoursAttempted>58</CreditHoursAttempted><CreditHoursEarned>58</CreditHoursEarned><GradePointAverage>86.6</GradePointAverage><CreditHoursforGPA>50</CreditHoursforGPA></GPA></AcademicSummary><AcademicSession><AcademicSessionDetail><SessionDesignator>2004-09</SessionDesignator><SessionDesignatorSuffix>70</SessionDesignatorSuffix><SessionName>Fall 2004</SessionName><SessionType>Semester</SessionType><SessionBeginDate>2004-09-01</SessionBeginDate><SessionEndDate>2004-12-15</SessionEndDate></AcademicSessionDetail><StudentLevel><StudentLevelCode>CollegeFirstYear</StudentLevelCode></StudentLevel><AcademicProgram><ProgramSecondarySchoolCode>CareerPrep</ProgramSecondarySchoolCode><AcademicProgramType>Major</AcademicProgramType><AcademicProgramName>International Project Manageme</AcademicProgramName></AcademicProgram><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>4</CourseCreditValue><CourseCreditEarned>4</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>77</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>308</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>101</CourseNumber><CourseTitle>Introduction to Development</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>88</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>264</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>102</CourseNumber><CourseTitle>Mgmt Skills for Intl Dev</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>86</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>258</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>103</CourseNumber><CourseTitle>Project Design and Planning</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>4</CourseCreditValue><CourseCreditEarned>4</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>86</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>344</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>104</CourseNumber><CourseTitle>Cross-Cultural Effectiveness</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>91</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>273</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>105</CourseNumber><CourseTitle>World Geography</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>80</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>240</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>106</CourseNumber><CourseTitle>Mgmt Information Systems</CourseTitle></Course><AcademicSummary><AcademicSummaryType>SenderOnly</AcademicSummaryType><AcademicSummaryLevel>Undergraduate</AcademicSummaryLevel><GPA><CreditHoursAttempted>20</CreditHoursAttempted><CreditHoursEarned>20</CreditHoursEarned><GradePointAverage>84.3</GradePointAverage><CreditHoursforGPA>20</CreditHoursforGPA></GPA></AcademicSummary></AcademicSession><AcademicSession><AcademicSessionDetail><SessionDesignator>2005-01</SessionDesignator><SessionDesignatorSuffix>30</SessionDesignatorSuffix><SessionName>Winter 2005</SessionName><SessionType>Semester</SessionType><SessionBeginDate>2005-01-15</SessionBeginDate><SessionEndDate>2005-05-15</SessionEndDate></AcademicSessionDetail><StudentLevel><StudentLevelCode>CollegeFirstYear</StudentLevelCode></StudentLevel><AcademicProgram><ProgramSecondarySchoolCode>CareerPrep</ProgramSecondarySchoolCode><AcademicProgramType>Major</AcademicProgramType><AcademicProgramName>International Project Manageme</AcademicProgramName></AcademicProgram><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>4</CourseCreditValue><CourseCreditEarned>4</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>87</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>348</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>201</CourseNumber><CourseTitle>Issues in Intl Development</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>86</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>258</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>202</CourseNumber><CourseTitle>Financial Management</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>95</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>285</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>203</CourseNumber><CourseTitle>Operations Management</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>4</CourseCreditValue><CourseCreditEarned>4</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>92</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>368</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>204</CourseNumber><CourseTitle>Project Mgmt: Sectoral Stds</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>93</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>279</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>206</CourseNumber><CourseTitle>Humanitarian Assistance</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>4</CourseCreditValue><CourseCreditEarned>4</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>93</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>372</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>303</CourseNumber><CourseTitle>Proj Des &amp; Planning- Sim</CourseTitle></Course><AcademicSummary><AcademicSummaryType>SenderOnly</AcademicSummaryType><AcademicSummaryLevel>Undergraduate</AcademicSummaryLevel><GPA><CreditHoursAttempted>21</CreditHoursAttempted><CreditHoursEarned>21</CreditHoursEarned><GradePointAverage>90.9</GradePointAverage><CreditHoursforGPA>21</CreditHoursforGPA></GPA></AcademicSummary></AcademicSession><AcademicSession><AcademicSessionDetail><SessionDesignator>2005-05</SessionDesignator><SessionDesignatorSuffix>50</SessionDesignatorSuffix><SessionName>Summer 2005</SessionName><SessionType>Semester</SessionType><SessionBeginDate>2005-05-20</SessionBeginDate><SessionEndDate>2005-06-30</SessionEndDate></AcademicSessionDetail><StudentLevel><StudentLevelCode>CollegeSophomore</StudentLevelCode></StudentLevel><AcademicProgram><ProgramSecondarySchoolCode>CareerPrep</ProgramSecondarySchoolCode><AcademicProgramType>Major</AcademicProgramType><AcademicProgramName>International Project Manageme</AcademicProgramName></AcademicProgram><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>85</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>255</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>205</CourseNumber><CourseTitle>Communication Skills for Mgrs</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>86</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>258</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>301</CourseNumber><CourseTitle>Speciac Topics: Intl Dev</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>3</CourseCreditValue><CourseCreditEarned>3</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>74</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>222</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>302</CourseNumber><CourseTitle>The Canadian Dev Context</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>2</CourseCreditValue><CourseCreditEarned>2</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>SAT</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>0</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>304</CourseNumber><CourseTitle>Career Orientation</CourseTitle></Course><Course><CourseCreditBasis>Regular</CourseCreditBasis><CourseCreditLevel>Undergraduate</CourseCreditLevel><CourseCreditValue>6</CourseCreditValue><CourseCreditEarned>6</CourseCreditEarned><CourseAcademicGradeScaleCode>89</CourseAcademicGradeScaleCode><CourseAcademicGrade>SAT</CourseAcademicGrade><CourseRepeatCode>RepeatCounted</CourseRepeatCode><CourseQualityPointsEarned>0</CourseQualityPointsEarned><CourseSubjectAbbreviation>IPMP</CourseSubjectAbbreviation><CourseNumber>400</CourseNumber><CourseTitle>Intl Development Proj or Plmt</CourseTitle></Course><AcademicSummary><AcademicSummaryType>SenderOnly</AcademicSummaryType><AcademicSummaryLevel>Undergraduate</AcademicSummaryLevel><GPA><CreditHoursAttempted>17</CreditHoursAttempted><CreditHoursEarned>17</CreditHoursEarned><GradePointAverage>81.6</GradePointAverage><CreditHoursforGPA>9</CreditHoursforGPA></GPA></AcademicSummary></AcademicSession></AcademicRecord></Student></ns0:CollegeTranscript>";
  Transcript.documents.insert({"title": "startup: test1 transcript", "description": "wow23333d Robin", pescCollegeTranscriptXML:pescXml});
  _(Transcript.documents.find({}).fetch()).each(function(transcipt){
    console.log(transcipt);
  });
  Document.updateAll();
});
